<script src="../simpletest.js"></script>
<script>

// Function signature:
  // every(array, callback(element[, index[, array]])[, thisArg])

// Callback parameters:
  // element
  // index
  // array

// Return value:
  // true if the callback function returns a truthy value for every array 
  // element. Otherwise, false.

// Description:
  // The every method tests whether all elements in the array pass the test 
  // implemented by the provided function. It returns a Boolean value.

// Case A: A falsy value is found.
  // The every method immediately returns false.
// Case B: A falsy value is not found.
  // every returns true.

// Case C: thisArg parameter is provided to every.
  // It will be used as callback's this value.
// Case D: thisArg parameter is not provided to every.
  // undefined will be used as its this value.

// Case E: callback is not invoked in two cases: 
  // for indexes that contain holes.
  // for indexes which have never been assigned values.

// callback will not run on elements that are appended to the array 
  // after the call to every begins.
// If existing elements of the array are changed, their value as passed to 
  // callback will be the value at the time every visits them.  
// Elements that are deleted are not visited.
// every does not mutate the array on which it is called.

// Edge case:
  // Calling this method on an empty array will return true for any condition.

// Test descriptions:
// '#1: It should run array.length times if every array element is truthy.'
// '#2: It should pass in ith element as the first argument to the callback.'
// '#3: It should pass in ith position as the second argument to the callback.'
// '#4: It should pass in the original array as the third argument to the callback.'
// '#5: It should accept an optional this argument.'
// '#6: If no optional this argument, this should be be undefined.'
// '#7: It should return true if every array element passes the test in callback.'
// '#8: It should return false immediately if one array element does not pass the test in callback.'
// '#9: It should not run callback on elements that are appended after the call begins.'
// '#10: It should skip holes in the array.'
// '#11: It should skip indexes which have never been assigned values.'
// '#12: It should skip deleted elements.'
// '#13: It should not mutate the array on which it is called.'
// '#14: It should return true if the array is empty.'

// Code:

function every(array, callback, optionalThis) {
  var everyCallback = callback;
  var arrayLength = array.length;
  var allElementsTruthy = true;

  if (optionalThis) {
    everyCallback = callback.bind(optionalThis);
  }

  for (var i = 0; i < arrayLength; i++) {
    if (i in array) {
      if ((everyCallback(array[i], i, array)) === true) {
        allElementsTruthy = true;
    } else {
        allElementsTruthy = false;
        return false;
    }
    }
  }
  if (allElementsTruthy === true) {
    return true;
  }
}

tests({
  'It should run array.length times if every array element is truthy.': function() {
    var numberOfTimesCallbackHasRun = 0;
    every([1, 2, 3], function(element) {
      numberOfTimesCallbackHasRun++;
      return element > 0;
    });
    eq(numberOfTimesCallbackHasRun, 3);
  },
  'It should pass in ith element as the first argument to the callback.': function() {
    every([1], function(element) {
      eq(element, 1);
    });
  },
  'It should pass in ith position as the second argument to the callback.': function() {
    every([1], function(element, index) {
      eq(index, 0);
    });
  },
  'It should pass in the original array as the third argument to the callback.': function() {
    var testArray = [];
    every(testArray, function(element, index, originalArray) {
      eq(originalArray, testArray);
    });
  },
  'It should accept an optional this argument.': function() {
    every([1], function() {
      eq(this.description, 'I should be accessible inside of the callback');
    }, {description: 'I should be accessible inside of the callback'});
  },
  'If no optional this argument, this should be be undefined.': function() {
    every([1], function(element, index, array) {
      eq(this.description, undefined);
    });
  },
  'It should return true if every array element passes the test in callback.': function() {
    var result = every([1, 2, 3], function(element) {
      return element > 0;
    });
    eq(result, true);
  },
  'It should return false immediately if one array element does not pass the test in callback.': function() {
    var result = every([1, 2], function(element) {
      return element === 1;
    });
    eq(result, false);
  },
  'It should not run callback on elements that are appended after the call begins.': function() {
    var numberOfTimesCallbackHasRun = 0;
    every([1, 2, 3], function(element, index, array) {
      numberOfTimesCallbackHasRun++
      array.push(4);
      return element > 0;
    });
    eq(numberOfTimesCallbackHasRun, 3);
  },
  'It should skip holes in the array.': function() {
    var numberOfTimesCallbackHasRun = 0;
    every([, 1, , 2, , 3], function(element) {
      numberOfTimesCallbackHasRun++;
      return element > 0;
    });
    eq(numberOfTimesCallbackHasRun, 3);
  },
  'It should skip indexes which have never been assigned values.': function() {
    var numberOfTimesCallbackHasRun = 0;
    every([1, 2, undefined, 3], function(element) {
      numberOfTimesCallbackHasRun++;
      return element > 0;
    });
    eq(numberOfTimesCallbackHasRun, 3);
  },
  'It should skip deleted elements.': function() {
    var numberOfTimesCallbackHasRun = 0;
    every([1, 2, 3], function(element, index, array) {
      numberOfTimesCallbackHasRun++;
      if (index === 0) {
        delete array[1];
      }
      return element > 0;
    });
    eq(numberOfTimesCallbackHasRun, 2);
  },
  'It should not mutate the array on which it is called.': function() {
    var testArray = [1, 2, 3];
    every(testArray, function(element) {
      return element > 1;
    });
    eq(testArray.length, 3);
  },
  'It should return true if the array is empty.': function() {
    var result = every([], function() {});
    eq(result, true);
  }
});

</script>